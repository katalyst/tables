<%= tag.table(**html_attributes) do %>
  <%= render caption if caption? %>
  <% if header? %>
    <%= tag.thead(**thead_attributes) do %>
      <%= header_row.render_in(view_context, &row_proc) %>
    <% end %>
  <% end %>
  <%= tag.tbody(**tbody_attributes) do %>
    <% collection.each do |record| %>
      <%= body_row(record).render_in(view_context) { |r| row_proc.call(r, record) } %>
    <% end %>
  <% end %>
<% end %>
